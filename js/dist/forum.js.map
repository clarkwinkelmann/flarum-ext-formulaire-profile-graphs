{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@clarkwinkelmann/formulaire-profile-graphs/webpack/bootstrap","webpack://@clarkwinkelmann/formulaire-profile-graphs/webpack/runtime/compat get default export","webpack://@clarkwinkelmann/formulaire-profile-graphs/webpack/runtime/define property getters","webpack://@clarkwinkelmann/formulaire-profile-graphs/webpack/runtime/hasOwnProperty shorthand","webpack://@clarkwinkelmann/formulaire-profile-graphs/webpack/runtime/make namespace object","webpack://@clarkwinkelmann/formulaire-profile-graphs/external root \"flarum.core.compat['common/extend']\"","webpack://@clarkwinkelmann/formulaire-profile-graphs/external root \"flarum.core.compat['forum/app']\"","webpack://@clarkwinkelmann/formulaire-profile-graphs/external root \"flarum.core.compat['common/components/LinkButton']\"","webpack://@clarkwinkelmann/formulaire-profile-graphs/external root \"flarum.core.compat['forum/ForumApplication']\"","webpack://@clarkwinkelmann/formulaire-profile-graphs/external root \"flarum.core.compat['forum/components/UserPage']\"","webpack://@clarkwinkelmann/formulaire-profile-graphs/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@clarkwinkelmann/formulaire-profile-graphs/external root \"flarum.core.compat['common/components/Switch']\"","webpack://@clarkwinkelmann/formulaire-profile-graphs/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@clarkwinkelmann/formulaire-profile-graphs/external root \"flarum.core.compat['common/helpers/icon']\"","webpack://@clarkwinkelmann/formulaire-profile-graphs/external root \"flarum.core.compat['common/utils/extractText']\"","webpack://@clarkwinkelmann/formulaire-profile-graphs/./src/forum/components/GraphsPage.ts","webpack://@clarkwinkelmann/formulaire-profile-graphs/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@clarkwinkelmann/formulaire-profile-graphs/./src/forum/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LinkButton'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/ForumApplication'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/UserPage'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Switch'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/icon'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/extractText'];","import app from 'flarum/forum/app';\nimport UserPage from 'flarum/forum/components/UserPage';\nimport Switch from 'flarum/common/components/Switch';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport LinkButton from 'flarum/common/components/LinkButton';\nimport icon from 'flarum/common/helpers/icon';\nimport extractText from 'flarum/common/utils/extractText';\n\nexport default class GraphsPage extends UserPage {\n    saving: boolean = false\n    saved: boolean = false\n    graphLoaded: boolean = false\n\n    oninit(vnode: any) {\n        super.oninit(vnode);\n\n        this.loadUser(m.route.param('username'));\n\n        // Start loading Plotly here instead of show() so we don't wait for the API request to the user endpoint to complete\n        if (!window.Plotly) {\n            const script = document.createElement('script');\n            script.crossOrigin = 'anonymous';\n            script.integrity = 'sha256-VmyeSwOmMUgMXMDjfU7ouLhV/EFZuOiE/f6CfSpLujw=';\n            script.src = 'https://cdn.jsdelivr.net/npm/plotly.js@2.14.0/dist/plotly.min.js';\n            script.onload = () => {\n                this.loadGraph();\n            };\n            document.body.appendChild(script);\n        }\n    }\n\n    oncreate(vnode: any) {\n        super.oncreate(vnode);\n\n        this.loadGraph();\n    }\n\n    show(user: any) {\n        super.show(user);\n\n        app.setTitle(extractText(app.translator.trans('clarkwinkelmann-formulaire-profile-graphs.forum.title')));\n\n        this.loadGraph();\n    }\n\n    loadGraph() {\n        // The graph can only be created once 3 conditions are met: the user is loaded, the component is created and Plotly lib is loaded\n        // To achieve this, this method will be called after each of those criteria change but will only execute once when all 3 are ready\n        if (!window.Plotly || !this.element || !this.user || this.graphLoaded) {\n            return;\n        }\n\n        this.graphLoaded = true;\n\n        const element = this.element.querySelector('.js-formulaire-profile-graph-plotly');\n\n        // If the page shows an error, the element won't exist\n        if (!element) {\n            return;\n        }\n\n        const x: any[] = [];\n        const y: any[] = [];\n\n        (this.user.attribute<any>('formulaireGraphsData') || []).forEach((entry: [any, any]) => {\n            x.push(entry[0]);\n            y.push(entry[1]);\n        });\n\n        Plotly.newPlot(element, [{\n            x,\n            y,\n        }], {\n            height: 500,\n            margin: {\n                t: 20,\n                b: 50,\n            },\n            xaxis: {\n                title: {\n                    text: this.user.attribute('formulaireGraphsXLabel'),\n                },\n            },\n            yaxis: {\n                title: {\n                    text: this.user.attribute('formulaireGraphsYLabel'),\n                },\n            },\n        });\n\n        const spinner = this.element.querySelector('.js-formulaire-profile-graph-spinner');\n\n        if (spinner instanceof HTMLElement) {\n            spinner.style.display = 'none';\n        }\n    }\n\n    content() {\n        if (!this.user!.attribute('formulaireGraphsVisible')) {\n            return m('.FormulaireProfileGraphsContent', [\n                m('.FormulaireProfileGraphsInvisible', app.translator.trans('clarkwinkelmann-formulaire-profile-graphs.forum.invisible')),\n            ]);\n        }\n\n        const editForm = app.forum.attribute('formulaire-profile-graphs.editForm');\n\n        return m('.FormulaireProfileGraphsContent', [\n            this.user!.attribute('formulaireGraphsCanChangeVisibility') ? m('.FormulaireProfileGraphsSettings', [\n                Switch.component({\n                    state: this.user!.attribute('formulaireGraphsPublic'),\n                    onchange: (state: boolean) => {\n                        this.saving = true;\n\n                        this.user!.save({\n                            formulaireGraphsPublic: state,\n                        }).then(() => {\n                            this.saving = false;\n                            this.saved = true;\n                            m.redraw();\n\n                            setTimeout(() => {\n                                this.saved = false;\n                                m.redraw();\n                            }, 4000);\n                        }).catch(error => {\n                            this.saving = false;\n                            m.redraw();\n                            throw error;\n                        });\n                    },\n                }, app.translator.trans('clarkwinkelmann-formulaire-profile-graphs.forum.makePublic')),\n                this.saving ? m('.FormulaireProfileGraphsSettingsSaving', LoadingIndicator.component({\n                    display: 'inline',\n                })) : (this.saved ? m('.FormulaireProfileGraphsSettingsSaving', icon('fas fa-check')) : null),\n            ]) : null,\n            m('.FormulaireProfileGraphsTitle', m('h3', app.translator.trans('clarkwinkelmann-formulaire-profile-graphs.forum.header'))),\n            m('.FormulaireProfileGraphsData', [\n                m('.FormulaireProfileGraphsDataLoading.js-formulaire-profile-graph-spinner', LoadingIndicator.component()),\n                m('.FormulaireProfileGraphsDataPlotly.js-formulaire-profile-graph-plotly'),\n            ]),\n            this.user === app.session.user && editForm ? m('.FormulaireProfileGraphsEdit', LinkButton.component({\n                className: 'Button',\n                href: app.route('formulaireProfile', {\n                    username: this.user!.username(),\n                    form: editForm,\n                }),\n                icon: 'fas fa-pen',\n            }, app.translator.trans('clarkwinkelmann-formulaire-profile-graphs.forum.editForm'))) : null,\n        ]);\n    }\n}\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","import {extend, override} from 'flarum/common/extend';\nimport app from 'flarum/forum/app';\nimport LinkButton from 'flarum/common/components/LinkButton';\nimport ForumApplication from 'flarum/forum/ForumApplication';\nimport UserPage from 'flarum/forum/components/UserPage';\nimport GraphsPage from './components/GraphsPage';\n\napp.initializers.add('clarkwinkelmann-formulaire-profile-graphs', () => {\n    // Define the route here first to make it more resilient against \"route does not exist\" errors\n    app.routes.formulaireProfileGraphs = {\n        // Intentionally not the same name as the default setting. This one is more unique to make extra sure no route exists with this name\n        path: '/u/:username/formulaire-graphs',\n        component: GraphsPage,\n    };\n\n    // Use override because we need to call our code after boot() to get access to app.forum, but before m.route() is called in mount()\n    // Similar logic to kilowhat/flarum-ext-custom-paths except we add a new route instead of editing any\n    override(ForumApplication.prototype, 'mount', function (original: any, ...args: any[]) {\n        app.routes.formulaireProfileGraphs.path = '/u/:username/' + app.forum.attribute('formulaire-profile-graphs.path');\n\n        original.call(this, ...args);\n    });\n\n    extend(UserPage.prototype, 'navItems', function (items) {\n        if (!this.user.attribute('formulaireGraphsVisible')) {\n            return;\n        }\n\n        items.add('formulaire-graphs', LinkButton.component({\n            href: app.route('formulaireProfileGraphs', {\n                username: this.user.slug(),\n            }),\n            icon: app.forum.attribute('formulaire-profile-graphs.icon'),\n        }, app.translator.trans('clarkwinkelmann-formulaire-profile-graphs.forum.nav')), app.forum.attribute('formulaire-profile-graphs.navPriority'));\n    });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","GraphsPage","subClass","superClass","saving","saved","graphLoaded","create","constructor","oninit","vnode","this","loadUser","m","route","param","window","Plotly","script","document","createElement","crossOrigin","integrity","src","onload","loadGraph","body","appendChild","oncreate","show","user","app","extractText","element","querySelector","x","y","attribute","forEach","entry","push","newPlot","height","margin","t","b","xaxis","title","text","yaxis","spinner","HTMLElement","style","display","content","editForm","Switch","state","onchange","save","formulaireGraphsPublic","then","redraw","setTimeout","error","LoadingIndicator","icon","LinkButton","className","href","username","form","UserPage","path","component","override","ForumApplication","original","args","extend","items","add","slug"],"sourceRoot":""}